
const express = require('express');
const app = express();
const port = process.env.PORT || 3000;

app.use(express.json());

const scoreTable = {
  "ì›ƒëŠ” ëª¨ìŠµì´ ê·€ì—½ê³  ìŠ¤ìœ—í•œ ìŠ¤íƒ€ì¼ ðŸ­":     [1,0,0,0,0,0,1],
  "ë§ìˆ˜ê°€ ì ì§€ë§Œ ê¹Šì´ ìžˆëŠ” ë¶„ìœ„ê¸° ðŸ“š":       [0,1,0,1,0,1,0],
  "ê¹”ë”í•˜ê³  ë‹¨ì •í•œ ë„ì‹œ ìŠ¤íƒ€ì¼ ðŸ™ï¸":         [0,0,1,0,0,0,1],
  "ê°“ êµ¬ìš´ ë‹¬ì½¤í•œ ì™€í”Œ ðŸ§‡":                 [1,0,0,0,0,0,1],
  "ì˜¤ëž˜ ë“ì¸ ê¹Šì€ ë§›ì˜ ë¯¸ì†Œëœìž¥êµ­ ðŸ²":       [0,1,0,1,0,1,0],
  "ì‹œì›í•˜ê³  ê°œìš´í•œ ê³¼ì¼ ìƒëŸ¬ë“œ ðŸ‰":         [0,0,1,0,0,0,1],
  "ìž”ìž”í•˜ê³  ê°ì„±ì ì¸ ë°œë¼ë“œ ðŸŽ¤":            [0,1,1,1,0,1,0],
  "íŒŒì›Œí’€í•œ ì‹ ë‚˜ëŠ” ì•„ì´ëŒ K-POP ðŸŽ¸":        [1,0,0,0,1,1,1],
  "ìš”ê°€ì²˜ëŸ¼ ë¶€ë“œëŸ½ê³  íŽ¸ì•ˆí•œ ìš´ë™ ðŸ§˜â€â™€ï¸":     [0,1,1,0,0,1,0],
  "ê·¼ìœ¡ì„ í‚¤ìš°ëŠ” ê°•ë„ ë†’ì€ í—¬ìŠ¤ ðŸ‹ï¸â€â™‚ï¸":     [1,1,0,0,1,0,0],
  "ê°€ë²¼ìš´ ë™ë„¤ ì‚°ì±… ðŸš¶â€â™‚ï¸":                 [0,0,0,0,0,0,1],
  "ìºì£¼ì–¼í•œ íŽì—ì„œ ê°€ë³ê²Œ ìˆ˜ë‹¤ ðŸŸ":         [1,0,0,0,1,0,1],
  "ê³ ê¸‰ ë‹¤ì´ë‹ì—ì„œ ì¢‹ì€ ë¶„ìœ„ê¸° ì¦ê¸°ê¸° ðŸ·":   [0,1,1,1,0,1,0],
  "ë¦¬ë·°ê°€ ë§Žì€ í˜„ì§€ ë§›ì§‘ ðŸŒ®":              [0,1,0,1,0,0,0],
  "íŽ¸í•˜ê²Œ ì¦ê¸°ëŠ” ë™ë„¤ ì‹ë‹¹ ðŸ":            [1,0,1,0,1,0,0],
  "ê¸¸ ê°€ë‹¤ê°€ ëŒë¦¬ëŠ” ê³³ìœ¼ë¡œ ë„ì „ ðŸ’¥":        [0,0,0,1,1,1,0],
  "ë”°ëœ»í•˜ê³  ê¸°ë¶„ ì¢‹ì€ í•´í”¼ì—”ë”© ðŸŽˆ":         [1,0,0,0,0,0,0],
  "ë¬µì§í•œ ê°ë™ì˜ ì§„í•œ ë“œë¼ë§ˆ ðŸŽ¬":           [0,1,1,1,0,1,0],
  "ìƒì¾Œí•˜ê³  ê¹”ë”í•œ ê²°ë§ì˜ ì˜í™” ðŸƒ":         [0,0,0,0,0,0,1],
  "ê¸°ë¶„ì´ ê°€ë²¼ì›Œì§€ëŠ” ì–´ì¿ ìŠ¤í‹± ðŸŽ§":          [1,0,0,0,0,0,1],
  "ê¹Šì´ ìžˆëŠ” í´ëž˜ì‹ì´ë‚˜ ìž¬ì¦ˆ ðŸŽ·":           [0,1,1,1,0,1,0],
  "ë§ˆìŒì´ íŽ¸ì•ˆí•´ì§€ëŠ” í”¼ì•„ë…¸ ì—°ì£¼ ðŸŽ¹":       [0,0,0,0,0,0,1]
};

const label = ["ë‘ê³¡","ëŒ€ê³¡ì£¼","ëª…ëƒ¥","êµ­êµ1573","ë‹ˆí•˜ì˜¤","ìž¥í–¥í˜•","ì²­í–¥í˜•"];
const descriptions = {
  "ë‘ê³¡":"ë‹¬ì½¤í•˜ê³  ë¶€ë“œëŸ¬ìš´ í–¥ì´ ë§¤ë ¥ì ì¸ ë‘ê³¡ì„ ì¶”ì²œí•©ë‹ˆë‹¤!",
  "ëŒ€ê³¡ì£¼":"ê¹Šì´ ìžˆëŠ” í–¥ê³¼ ë¬´ê²Œê° ìžˆëŠ” ëŒ€ê³¡ì£¼ê°€ ìž˜ ì–´ìš¸ë ¤ìš”.",
  "ëª…ëƒ¥":"ê¹”ë”í•˜ê³  ì •ì œëœ ìŠ¤íƒ€ì¼ì˜ ëª…ëƒ¥ì€ ë„ì‹œì ì¸ ë‹¹ì‹ ì—ê²Œ ë”±!",
  "êµ­êµ1573":"ì¤‘í›„í•˜ê³  ê³ ê¸‰ìŠ¤ëŸ¬ìš´ êµ­êµ1573, ì§„í•œ ê°ì„±ì„ ê°€ì§„ ë‹¹ì‹ ì—ê²Œ.",
  "ë‹ˆí•˜ì˜¤":"ëª¨í—˜ì ì¸ ë‹¹ì‹ ì—ê² ë‹ˆí•˜ì˜¤ì²˜ëŸ¼ ì‹ ì„ í•œ ìˆ ì´ ì–´ìš¸ë ¤ìš”!",
  "ìž¥í–¥í˜•":"ë…íŠ¹í•œ ë§¤ë ¥ì„ ì§€ë‹Œ ìž¥í–¥í˜• í–¥ì„ ì¦ê²¨ë³´ì„¸ìš”.",
  "ì²­í–¥í˜•":"ê°€ë³ê³  ì²­ëŸ‰í•œ ì²­í–¥í˜• ìˆ ì´ ë‹¹ì‹ ì˜ ë¬´ë“œë¥¼ ë‹®ì•˜ì–´ìš”."
};

app.post("/webhook",(req,res)=>{
  const body=req.body;
  const answers=[body.q1,body.q2,body.q3,body.q4,body.q5,body.q6,body.q7,body.q8];
  const totals=[0,0,0,0,0,0,0];
  answers.forEach(ans=>{
    const scores=scoreTable[ans];
    if(scores){
      scores.forEach((v,i)=>totals[i]+=v);
    }
  });
  const maxScore=Math.max(...totals);
  const maxIndex=totals.indexOf(maxScore);
  const result=label[maxIndex];
  res.json({recommendation:result,score:maxScore,message:descriptions[result]});
});
app.get("/",(req,res)=>res.send("Server running"));
app.listen(port, () => console.log("Listening on port " + port));

